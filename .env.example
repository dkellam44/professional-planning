# ============================================================================
# ENVIRONMENT CONFIGURATION - Portfolio Service Infrastructure
# ============================================================================
# ⚠️  SECURITY: DO NOT COMMIT THIS FILE - It contains sensitive secrets
# This file is in .gitignore and should never be pushed to remote repo
# Update .env.example instead for documentation
# ============================================================================

# ============================================================================
# SECTION 1: RUNTIME & NODE.JS CONFIGURATION
# ============================================================================
NODE_ENV=development
MCP_SERVER_PORT=8080
PORT=3000
APP_BASE_URL=http://localhost:3000

# ============================================================================
# SECTION 2: STYTCH OAUTH 2.1 AUTHENTICATION (Phase 2 - NEW)
# ============================================================================
# Stytch is the OAuth 2.1 provider for ChatGPT/Claude.ai web integration
# Get these from: https://stytch.com/dashboard
#
# To set up:
# 1. Create Stytch account at https://stytch.com
# 2. Create new project in dashboard
# 3. Generate Project ID and API Secret
# 4. Copy values here and to docker-compose.yml
# Project: Coda MCP - Production
STYTCH_PROJECT_ID=
STYTCH_SECRET=
STYTCH_DOMAIN=
STYTCH_PUBLIC_TOKEN=
STYTCH_CUSTOM_AUTH_DOMAIN=

# ============================================================================
# SECTION 3: CODA API INTEGRATION (Service Token)
# ============================================================================
# Service token for MCP server to access Coda API
# Generate at: https://coda.io/account/settings#api
CODA_API_TOKEN=

# ============================================================================
# SECTION 4: CLOUDFLARE INTEGRATION (Phase 1 - Legacy, deprecate Phase 2F)
# ============================================================================
# Currently used for zero-IP tunnel and JWT authentication
# Phase 2F: Will be replaced with Stytch OAuth 2.1
# Phase 2F: Bearer token fallback will remain for Claude Code development
#
# Cloudflare Dashboard: https://dash.cloudflare.com/
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_REMOTE_URL=
CLOUDFLARE_ACCOUNT_ID=
CLOUDFLARE_TUNNEL_TOKEN=

# ============================================================================
# SECTION 5: AUTHENTICATION & SECURITY
# ============================================================================
# Session & JWT secrets for general application auth
SESSION_SECRET=your_session_secret_change_me
JWT_SECRET=your_jwt_secret_change_me

# Bearer token for Claude Code development (fallback for Phase 2)
BEARER_TOKEN=test-token

# Encryption key for AES-256-GCM (Phase 3: Service token storage)
# Generate with: openssl rand -hex 32
MCP_AUTH_ENCRYPTION_KEY=your_encryption_key_32_bytes_hex_here

# ============================================================================
# SECTION 6: POSTGRESQL DATABASE (Infrastructure)
# ============================================================================
# Current: Used by n8n, qdrant metadata, and other services
# Phase 3: Will also store encrypted service tokens (Coda API token)
#
# Droplet Connection: postgres service in docker-compose.yml
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=
POSTGRES_DB=portfolio_db

# SSL mode for remote connections (disable for local docker)
PGSSLMODE=disable

# Connection pool settings
POSTGRES_MIN_CONNECTIONS=2
POSTGRES_MAX_CONNECTIONS=10

# Database URL format (alternative to individual vars)
DATABASE_URL=postgres://postgres:your_postgres_password_here@localhost:5432/portfolio_db

# ============================================================================
# SECTION 7: N8N WORKFLOW AUTOMATION (Droplet Service)
# ============================================================================
# n8n deployed on droplet for workflow automation
# Dashboard: https://n8n.bestviable.com (via Traefik)
N8N_HOST=n8n
N8N_PORT=5678
N8N_ENCRYPTION_KEY=
N8N_USER_MANAGEMENT_JWT_SECRET=your_n8n_jwt_secret_here
N8N_DB_URL=postgres://postgres:your_postgres_password_here@postgres:5432/n8n_db
N8N_API_KEY=your_n8n_api_key_here
N8N_ADMIN_EMAIL=dkellam44@gmail.com
N8N_ADMIN_PASSWORD=

# ============================================================================
# SECTION 8: QDRANT VECTOR DATABASE (Droplet Service)
# ============================================================================
# Qdrant for vector storage and semantic search
# Used for embeddings and similarity search
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_GRPC_PORT=6334
QDRANT_API_KEY=

# ============================================================================
# SECTION 9: REDIS CACHE (Optional - If needed for token validation)
# ============================================================================
# Redis for caching and session management
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_DB=0
REDIS_URL=redis://default:your_redis_password_here@localhost:6379/0

# ============================================================================
# SECTION 10: OPENWEBUI (Droplet Service)
# ============================================================================
# OpenWebUI for LLM interface and model management
OPENWEBUI_HOST=openweb
OPENWEBUI_PORT=3000
OPENWEBUI_ADMIN_EMAIL=admin@example.com
OPENWEBUI_ADMIN_PASSWORD=your_openwebui_password_here

# ============================================================================
# SECTION 11: TRAEFIK REVERSE PROXY (Droplet Service)
# ============================================================================
# Traefik v3.0 for routing traffic to all services
# Dashboard available at: https://traefik.bestviable.com
TRAEFIK_DASHBOARD_USER=admin
TRAEFIK_DASHBOARD_PASSWORD=your_traefik_password_here
TRAEFIK_ACME_EMAIL=admin@example.com

# ============================================================================
# SECTION 12: SERVICE DOMAIN CONFIGURATION
# ============================================================================
# Domain routing for different services
MCP_DOMAIN=coda.bestviable.com
API_DOMAIN=api.bestviable.com
WEB_DOMAIN=bestviable.com

# ============================================================================
# SECTION 13: TOKEN STORAGE STRATEGY
# ============================================================================
# Controls where service tokens (Coda API token) are stored
# Phase 1 (current):  'env'        - Environment variable (CODA_API_TOKEN)
# Phase 3 (future):   'postgres'   - Encrypted in PostgreSQL
# Phase 4 (future):   'infisical'  - Infisical secrets manager
TOKEN_STORE=env

# ============================================================================
# SECTION 14: INFISICAL SECRETS MANAGER (Phase 4 - Centralized Secrets)
# ============================================================================
# Infisical for managing secrets across infrastructure
# Phase 4: Will replace environment-based secret management
#
# Dashboard: https://infisical.com/
INFISICAL_HOST=infisical.bestviable.com
INFISICAL_API_KEY=
INFISICAL_WORKSPACE_ID=
INFISICAL_TOKEN=

# ============================================================================
# SECTION 15: LLM / AI PROVIDERS (For development & testing)
# ============================================================================
# OpenAI - ChatGPT
# "Open AI General API 2025-11-05"
OPENAI_API_KEY=
OPENAI_ORG_ID=                # optional
OPENAI_PROJECT=               # optional (some newer SDKs)

# Anthropic - Claude
#"Anthropic API - anthropic-general-2025-11-05"
ANTHROPIC_API_KEY=

# Google / Gemini
# "Google API Key -Gemini Access 2025-10-26"
GOOGLE_API_KEY=
GOOGLE_APPLICATION_CREDENTIALS= # ./secrets/google-creds.json (JSON file path)

# OpenRouter (multi-provider gateway)
# "Initial OpenRouter Key"
OPENROUTER_API_KEY=
# Moonshot (Kimi)
#"Moonshot AI - General API 2025-11-06"
MOONSHOT_API_KEY=

# Zen (Opencode)
OPENCODE_API_KEY=
# Hugging Face
HUGGINGFACE_API_KEY=

# LLM Provider selection
LLM_PROVIDER=anthropic          # anthropic | openai | openrouter | google

# ============================================================================
# SECTION 16: OBJECT STORAGE (AWS S3 Compatible - Optional)
# ============================================================================
# For future file uploads, backups, etc.
AWS_ACCESS_KEY_ID=your_aws_access_key_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_REGION=us-east-1
AWS_S3_ENDPOINT=https://nyc3.digitaloceanspaces.com  # DigitalOcean Spaces example
S3_BUCKET_NAME=your_bucket_name_here

# ============================================================================
# SECTION 17: EMAIL CONFIGURATION (Optional - SMTP)
# ============================================================================
# For sending notifications, password resets, etc.
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_SECURE=false              # true to enforce TLS

# ============================================================================
# SECTION 18: SSH AGENT & DEPLOYMENT
# ============================================================================
# SSH access to Digital Ocean droplet for deployments
SSH_AGENT_DO=droplet
DIGITALOCEAN_API_TOKEN=
DIGITALOCEAN_SERVICES=
DIGITALOCEAN_API_ENDPOINT=https://api.digitalocean.com
DIGITALOCEAN_LOG_LEVEL=info

# ============================================================================
# SECTION 19: LOGGING & DEBUGGING
# ============================================================================
LOG_LEVEL=info                  # debug | info | warn | error
DEBUG=false
MCP_DEBUG=false                 # Enable verbose MCP protocol logging
SENTRY_DSN=your_sentry_dsn_here  # Error tracking (optional)

# ============================================================================
# SECTION 20: FEATURE FLAGS & OPTIONAL SETTINGS
# ============================================================================
FEATURE_FLAGS=                  # e.g. alpha,beta,stytch-oauth
WATCH_MODE=false                # Enable auto-reload in development
TYPESCRIPT_WATCH=false          # Enable TypeScript watch mode
STYTCH_OAUTH_REDIRECT_URI=https://coda.bestviable.com/oauth/authorize
