{
  "name": "memory-assemble",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "memory/assemble",
        "responseMode": "lastNode",
        "options": {
          "responseCode": 200,
          "responseHeaders": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "id": "Webhook_memory_assemble",
      "name": "assemble_webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        200,
        300
      ],
      "webhookId": "memory-assemble"
    },
    {
      "parameters": {
        "functionCode": "const input = items[0]?.json ?? {};\\nconst clientId = input.client_id ?? 'anonymous';\\nconst query = input.query ?? '';\\nconst limit = Number.isFinite(Number(input.limit)) ? Number(input.limit) : 5;\\nconst includeProfile = input.include_profile !== false;\\nconst includeEpisodes = input.include_episodes !== false;\\nconst includeSimilar = input.include_similar !== false;\\nreturn [{\\n  json: {\\n    client_id: clientId,\\n    query,\\n    options: {\\n      limit,\\n      includeProfile,\\n      includeEpisodes,\\n      includeSimilar\\n    },\\n    raw_input: input,\\n    received_at: new Date().toISOString()\\n  }\\n}];"
      },
      "id": "Function_normalize_request",
      "name": "normalize_request",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        420,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const item = items[0].json;\\nconst { client_id, query, options } = item;\\nconst now = new Date();\\nconst profile = options.includeProfile ? [\\n  { label: 'Preferred Tone', value: 'Encouraging' },\\n  { label: 'Focus Areas', value: ['Memory orchestration', 'Automation hygiene'] },\\n  { label: 'Last Updated', value: now.toISOString() }\\n] : [];\\nconst episodes = options.includeEpisodes ? [\\n  { occurred_at: new Date(now.getTime() - 1000 * 60 * 60 * 12).toISOString(), summary: 'Reviewed Cloudflare tunnel configuration and issued SSL certificates.', importance: 0.6 },\\n  { occurred_at: new Date(now.getTime() - 1000 * 60 * 60 * 24).toISOString(), summary: 'Captured droplet resource snapshot ahead of Phase 3 workflows.', importance: 0.4 }\\n] : [];\\nconst similar = options.includeSimilar ? [\\n  { title: 'Droplet Memory Plan', snippet: 'Architectural canvas for OpenMemory + Letta + n8n orchestration.', score: 0.91, path: 'Droplet Memory Plan.md' },\\n  { title: 'WORKFLOW_README.md', snippet: 'Specifications for memory workflows and hook contract.', score: 0.87, path: 'workflows/n8n/WORKFLOW_README.md' }\\n] : [];\\nreturn [{\\n  json: {\\n    status: 'ok',\\n    client_id,\\n    query,\\n    context: {\\n      profile,\\n      recent_episodes: episodes,\\n      similar_chunks: similar,\\n      working_notes: ['Replace stub context with live Postgres + Qdrant retrieval.']\\n    },\\n    metadata: {\\n      received_at: item.received_at,\\n      generated_at: now.toISOString(),\\n      limit: options.limit\\n    }\\n  }\\n}];"
      },
      "id": "Function_build_context",
      "name": "build_context",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        640,
        300
      ]
    }
  ],
  "connections": {
    "assemble_webhook": {
      "main": [
        [
          {
            "node": "normalize_request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalize_request": {
      "main": [
        [
          {
            "node": "build_context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
